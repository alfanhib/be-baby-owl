# Module 4: Content Delivery

**Module ID:** M04  
**Module Name:** Content Delivery  
**Priority:** ğŸŸ  High (Phase 2, Sprint 4-7)  
**Story Points:** 75 points  
**Owner:** Frontend Team + Backend Team

---

## ğŸ“‹ Module Overview

### Purpose

This module handles the **delivery of learning content** to students, including video lessons (YouTube embed), quiz system (6 types), reading materials, downloadable resources, and **interactive Python coding exercises**. This is the core learning experience for students.

### Business Value

- **Student Engagement:** Rich content types keep students engaged
- **Learning Outcomes:** Multiple content formats improve knowledge retention
- **Completion Rates:** Interactive quizzes (6 types) increase participation
- **Flexibility:** Video + reading + quizzes = comprehensive learning
- **Practical Skills:** Interactive coding exercises enable hands-on programming practice
- **Immediate Feedback:** Auto-graded coding challenges provide instant feedback

### Success Metrics

- Video completion rate: >80%
- Quiz completion rate: >85%
- Quiz pass rate (>70% score): >75%
- Coding exercise completion rate: >70%
- Coding challenge pass rate (all tests): >60%
- Content load time: <2 seconds
- Pyodide load time: <5 seconds (first load)
- Student satisfaction with content: >4.5/5

---

## ğŸ‘¥ User Roles

- **Student:** Consumes content (watch videos, read materials, take quizzes, complete coding exercises)
- **Instructor/Admin:** Creates and edits content (upload videos, create quizzes, write materials, create coding challenges with test cases)

---

## ğŸ“š User Stories

### Story 2.2.1: Video Exercises (YouTube Embed, Progress Tracking)

**Story Points:** 8  
**Priority:** ğŸ”´ Critical  
**Sprint:** Sprint 4

#### User Story

```
AS A student
I WANT TO watch video exercises within a lesson
SO THAT I can learn visually and at my own pace
```

#### Acceptance Criteria

**AC1: Exercise Renderer - Video Type**

- GIVEN I am viewing a lesson with video exercise
- WHEN the lesson page loads
- THEN I see:
  - Lesson title (e.g., "Lesson 1: Introduction")
  - Exercise navigation (e.g., "Exercise 1 of 3")
  - Current exercise: Video type
  - YouTube video embedded (iframe, responsive)
  - Exercise title (e.g., "Welcome Video")
  - Exercise description (below player)
  - Playback controls (YouTube's default: play/pause, volume, speed, fullscreen)
  - Progress indicator (how much I've watched)
  - "Mark as Complete" button (after watching >80% of video)
  - "Next Exercise" button (to proceed to next exercise)

**AC2: Video Progress Tracking (Exercise Level)**

- GIVEN I am watching a video exercise
- WHEN I watch for a certain duration
- THEN:
  - Progress saved to database every 30 seconds
  - If I leave and return to same exercise, video resumes from last position
  - Example: Watch 3 minutes â†’ close tab â†’ reopen lesson â†’ click same exercise â†’ resumes at 3:00

**AC3: Video Completion Detection**

- GIVEN I have watched >80% of video duration
- WHEN the watch percentage exceeds 80%
- THEN:
  - "Mark as Complete" button becomes enabled (was disabled)
  - Green checkmark appears on exercise (in exercise list)
  - XP earned (+10 XP for video exercise completion)
  - Toast notification: "Exercise completed! +10 XP"
  - Lesson progress updated (e.g., "1/3 exercises complete")

**AC4: Manual Completion Toggle**

- GIVEN "Mark as Complete" button is enabled
- WHEN I click the button
- THEN:
  - Exercise marked complete in database
  - Checkmark turns green
  - XP awarded (if not already awarded)
  - "Mark as Complete" changes to "Completed âœ“"
  - If all exercises in lesson complete â†’ Lesson also marked complete
- GIVEN exercise is already complete
- WHEN I click "Completed âœ“" button
- THEN:
  - Exercise marked incomplete (toggle)
  - Checkmark turns gray
  - XP NOT removed (keep XP even if unmarked)

**AC5: Navigate Between Exercises**

- GIVEN I complete video exercise
- WHEN I click "Next Exercise" button
- THEN:
  - Navigates to next exercise in lesson (e.g., Quiz exercise)
  - If last exercise â†’ "Next Exercise" button changes to "Complete Lesson"
  - If first exercise â†’ "Previous Exercise" button disabled

**AC6: Video Speed Control**

- YouTube player provides default speed control (0.5x, 0.75x, 1x, 1.25x, 1.5x, 2x)
- Student can adjust speed as needed

**AC7: Fullscreen Support**

- Student can enter fullscreen mode via YouTube player controls
- Exit fullscreen returns to lesson page (exercise still visible)

---

#### Edge Cases

**E1: YouTube Video URL Invalid**

- If URL doesn't exist or is deleted:
  - Show placeholder: "Video unavailable. Please contact support."
  - Log error (backend)
  - Notify instructor (email alert)

**E2: YouTube Embed Blocked (Privacy Settings)**

- If video has embedding disabled:
  - Show error: "This video cannot be embedded. Please watch on YouTube."
  - Provide "Watch on YouTube" link

**E3: Network Error (Video Won't Load)**

- If video fails to load:
  - Show retry button
  - "Reload Video" button

**E4: Very Short Video (<1 minute)**

- Completion threshold: Watch >80% OR watch entire video
- Example: 30-second video â†’ watch 24 seconds = complete

**E5: Progress Save Failure**

- If save fails (network error):
  - Queue save locally (IndexedDB)
  - Retry when connection restored

**E6: Multiple Tabs Open (Same Exercise)**

- Only track progress from most recent tab
- Use timestamp to determine latest activity

**E7: Switching Between Exercises**

- Progress saved when switching exercises
- Can return to partially watched video (resumes from saved position)

**E8: Lesson with Only Video Exercises**

- If lesson has 5 video exercises, student watches all 5
- After completing all 5 â†’ Lesson marked complete
- Lesson progress: "5/5 exercises complete (100%)"

---

#### API Contracts

**Endpoint 1:** `GET /api/lessons/:lessonId/exercises` (Get all exercises in lesson)

**Response (Lesson with Exercises - 200 OK):**

```json
{
  "success": true,
  "data": {
    "lesson": {
      "id": "lesson_456",
      "title": "Introduction to React Native",
      "description": "Learn the basics of React Native",
      "exerciseCount": 3,
      "progress": {
        "exercisesCompleted": 1,
        "totalExercises": 3,
        "completionPercentage": 33
      }
    },
    "exercises": [
      {
        "id": "exercise_789",
        "title": "Welcome Video",
        "type": "video",
        "orderIndex": 1,
        "content": {
          "youtubeUrl": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
          "youtubeId": "dQw4w9WgXcQ",
          "description": "<p>Welcome to the course...</p>",
          "duration": 300 // seconds (5 minutes)
        },
        "progress": {
          "completed": true,
          "watchedSeconds": 300,
          "completionPercentage": 100
        }
      },
      {
        "id": "exercise_790",
        "title": "Quiz - Basic Concepts",
        "type": "quiz",
        "orderIndex": 2,
        "content": {
          /* quiz data */
        },
        "progress": {
          "completed": false
        }
      },
      {
        "id": "exercise_791",
        "title": "Setup Guide",
        "type": "material",
        "orderIndex": 3,
        "content": {
          /* material data */
        },
        "progress": {
          "completed": false
        }
      }
    ]
  }
}
```

---

**Endpoint 2:** `POST /api/exercises/:exerciseId/progress` (Update video watch progress)

**Request Body:**

```json
{
  "watchedSeconds": 180,
  "completed": false
}
```

**Response (Success - 200 OK):**

```json
{
  "success": true,
  "data": {
    "progress": {
      "exerciseId": "exercise_789",
      "watchedSeconds": 180,
      "completionPercentage": 60,
      "completed": false
    }
  }
}
```

---

**Endpoint 3:** `POST /api/exercises/:exerciseId/complete` (Mark exercise complete)

**Request Body:**

```json
{
  "completed": true
}
```

**Response (Success - 200 OK):**

```json
{
  "success": true,
  "data": {
    "exercise": {
      "id": "exercise_789",
      "completed": true,
      "completedAt": "2025-12-01T12:00:00Z"
    },
    "xpEarned": 10,
    "lessonProgress": {
      "exercisesCompleted": 1,
      "totalExercises": 3,
      "lessonCompleted": false
    }
  }
}
```

---

**Endpoint 4:** `POST /api/lessons/:lessonId/complete` (Mark entire lesson complete - when all exercises done)

**Response (Success - 200 OK):**

```json
{
  "success": true,
  "data": {
    "lesson": {
      "id": "lesson_456",
      "completed": true,
      "completedAt": "2025-12-01T13:00:00Z",
      "exercisesCompleted": 3,
      "totalExercises": 3
    },
    "totalXpEarned": 30 // Sum of all exercises
  }
}
```

---

#### Dependencies

- Module 3 (Course structure, lessons)
- Module 7 (Progress tracking)
- Module 8 (XP system)

---

#### Test Scenarios

**TS1: Watch Video (First Time)**

1. Navigate to video lesson
2. Verify YouTube video loads
3. Play video for 5 minutes
4. Verify progress saved (watchedSeconds: 300)
5. Close tab, reopen lesson
6. Verify video resumes at 5:00

**TS2: Complete Video**

1. Watch video from start
2. Watch >80% (e.g., 12 minutes of 15-minute video)
3. Verify "Mark as Complete" button enabled
4. Click button
5. Verify toast: "+10 XP"
6. Verify checkmark green
7. Navigate away and return â†’ verify still marked complete

**TS3: Video Unavailable**

1. Instructor sets invalid YouTube URL
2. Student navigates to lesson
3. Verify error message: "Video unavailable"
4. Verify "Contact Support" link

---

#### UI/UX Notes

**Video Lesson Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back to Course                               â”‚
â”‚                                                 â”‚
â”‚  Lesson 1: Introduction to React Native        â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚        YouTube Video Player             â”‚   â”‚
â”‚  â”‚         (16:9 aspect ratio)             â”‚   â”‚
â”‚  â”‚                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  Progress: â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 50%           â”‚
â”‚                                                 â”‚
â”‚  [ Mark as Complete ]                          â”‚
â”‚                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚                                                 â”‚
â”‚  Description                                    â”‚
â”‚  In this lesson, we'll cover the basics...     â”‚
â”‚                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚                                                 â”‚
â”‚  [ â† Previous Lesson ]    [ Next Lesson â†’ ]    â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Colors:**

- Progress bar: `PRIMARY_200` (purple)
- Complete button (enabled): `ALERT_SUCCESS_100` (green)
- Complete button (disabled): `GREYSCALE_300` (gray)

---

---

### Story 2.2.2: Reading Materials (Rich Text, Images, Formatting)

**Story Points:** 5  
**Priority:** ğŸŸ  High  
**Sprint:** Sprint 4

#### User Story

```
AS A student
I WANT TO read text-based lessons
SO THAT I can learn concepts through reading
```

#### Acceptance Criteria

**AC1: Reading Material Display**

- GIVEN I am viewing a reading material lesson
- WHEN the lesson page loads
- THEN I see:
  - Lesson title
  - Rich text content (formatted HTML):
    - Headings (H1, H2, H3)
    - Paragraphs
    - Bold, italic, underline
    - Bullet lists, numbered lists
    - Images (inline, responsive)
    - Code blocks (syntax highlighted)
    - Blockquotes
    - Links (open in new tab)
  - "Mark as Complete" button (always enabled)
  - Reading progress indicator (scroll depth)

**AC2: Reading Progress Tracking**

- GIVEN I am reading the material
- WHEN I scroll down the page
- THEN:
  - Progress calculated based on scroll depth
  - Example: Scrolled 50% â†’ progress = 50%
  - Progress saved to database
  - On return, page scrolls to last position

**AC3: Mark as Complete**

- GIVEN I click "Mark as Complete"
- WHEN the button is clicked
- THEN:
  - Lesson marked complete
  - XP earned (+10 XP)
  - Checkmark turns green
  - Toast: "Lesson completed! +10 XP"

**AC4: Image Lazy Loading**

- Images load as user scrolls (lazy loading)
- Show placeholder/skeleton while loading

**AC5: Code Block Syntax Highlighting**

- Code blocks display with syntax highlighting
- Support languages: JavaScript, TypeScript, Python, HTML, CSS
- "Copy Code" button on hover

---

#### API Contract

**Endpoint:** `GET /api/lessons/:lessonId`

**Response (Reading Material - 200 OK):**

```json
{
  "success": true,
  "data": {
    "lesson": {
      "id": "lesson_789",
      "title": "What is React Native?",
      "type": "reading",
      "content": {
        "body": "<h2>What is React Native?</h2><p>React Native is...</p><img src='...' /><pre><code class='language-javascript'>const App = () => {...}</code></pre>"
      },
      "progress": {
        "completed": false,
        "scrollDepth": 45
      }
    }
  }
}
```

---

#### Test Scenarios

**TS1: Read Material**

1. Navigate to reading material lesson
2. Verify content displays (formatted)
3. Scroll down 50%
4. Verify progress saved
5. Close tab, reopen
6. Verify page scrolls to 50% position

**TS2: Complete Reading**

1. On reading material page
2. Click "Mark as Complete"
3. Verify toast: "+10 XP"
4. Verify checkmark green

---

---

### Story 2.2.3: File Downloads (PDFs, Resources)

**Story Points:** 3  
**Priority:** ğŸŸ  High  
**Sprint:** Sprint 4

#### User Story

```
AS A student
I WANT TO download supplementary materials (PDFs, files)
SO THAT I can study offline or reference later
```

#### Acceptance Criteria

**AC1: Download Section**

- GIVEN a lesson has downloadable files
- WHEN the lesson page loads
- THEN I see:
  - "Downloads" section (below main content)
  - List of files:
    - File name (e.g., "Lesson 1 Slides.pdf")
    - File type icon (ğŸ“„ PDF, ğŸ“Š Excel, ğŸ“ Word, etc.)
    - File size (e.g., "2.5 MB")
    - "Download" button

**AC2: Download File**

- GIVEN I click "Download" button
- WHEN the click is processed
- THEN:
  - File downloads (browser's native download)
  - Download tracked (analytics: file downloaded)
  - No XP earned for download (passive action)

**AC3: Multiple Files**

- Lesson can have 0-10 files
- Display all files in list format

---

#### API Contract

**Download URL:**

```
https://cdn.babyowl.com/downloads/courses/course_123/lesson_456/slides.pdf
```

Or via backend proxy (for analytics):

```
GET /api/lessons/:lessonId/download/:fileId
```

---

#### Test Scenarios

**TS1: Download File**

1. Navigate to lesson with downloads
2. Verify "Downloads" section visible
3. Verify file listed: "Lesson 1 Slides.pdf (2.5 MB)"
4. Click "Download"
5. Verify file downloads

---

---

### Story 2.2.4: Quiz System - Multiple Choice

**Story Points:** 8  
**Priority:** ğŸ”´ Critical  
**Sprint:** Sprint 5

#### User Story

```
AS A student
I WANT TO take multiple choice quizzes
SO THAT I can test my understanding
```

#### Acceptance Criteria

**AC1: Multiple Choice Quiz Display**

- GIVEN I am viewing a multiple choice quiz lesson
- WHEN the page loads
- THEN I see:
  - Quiz title
  - Question text (supports rich text, images)
  - 4 answer options (A, B, C, D)
  - Radio buttons (single selection)
  - "Submit Answer" button (disabled until option selected)
  - Question number (e.g., "Question 1 of 10")
  - Timer (optional, for future)

**AC2: Select Answer**

- GIVEN I select an answer option
- WHEN I click a radio button
- THEN:
  - Option highlighted
  - "Submit Answer" button enabled

**AC3: Submit Answer (Correct)**

- GIVEN I select the correct answer
- WHEN I click "Submit Answer"
- THEN:
  - Option turns green âœ“
  - Feedback message: "Correct! [Explanation]"
  - XP earned (+5 XP per correct answer)
  - "Next Question" button appears (if more questions)
  - "Finish Quiz" button appears (if last question)

**AC4: Submit Answer (Incorrect)**

- GIVEN I select an incorrect answer
- WHEN I click "Submit Answer"
- THEN:
  - Selected option turns red âœ—
  - Correct option turns green âœ“
  - Feedback message: "Incorrect. The correct answer is [X]. [Explanation]"
  - No XP earned for incorrect answer
  - "Next Question" or "Finish Quiz" button appears

**AC5: Quiz Completion**

- GIVEN I finish all questions
- WHEN I click "Finish Quiz"
- THEN:
  - Quiz marked complete
  - Score calculated (e.g., "8/10 correct - 80%")
  - XP earned (total for all correct answers)
  - Results summary page:
    - Total score
    - Correct/incorrect per question
    - Explanations
    - "Retake Quiz" button (optional)
    - "Continue to Next Lesson" button

**AC6: Retake Quiz**

- Student can retake quiz unlimited times
- Best score saved
- Questions may be randomized (optional)

---

#### Edge Cases

**E1: Multiple Attempts**

- If student retakes quiz:
  - Previous answers NOT pre-filled (start fresh)
  - Best score saved (not overwritten by lower score)

**E2: Image in Question**

- Support images in question text (e.g., code screenshot)
- Images responsive, load quickly

**E3: Very Long Options**

- Options wrap to multiple lines if long
- Maintain readability

---

#### API Contract

**Endpoint 1:** `GET /api/lessons/:lessonId` (Quiz type)

**Response (Multiple Choice Quiz - 200 OK):**

```json
{
  "success": true,
  "data": {
    "lesson": {
      "id": "lesson_111",
      "title": "React Native Basics Quiz",
      "type": "quiz",
      "content": {
        "quizType": "multiple_choice",
        "questions": [
          {
            "id": "q1",
            "text": "What is React Native?",
            "image": null,
            "options": [
              { "id": "a", "text": "A web framework" },
              { "id": "b", "text": "A mobile framework" },
              { "id": "c", "text": "A database" },
              { "id": "d", "text": "A programming language" }
            ],
            "correctAnswer": "b",
            "explanation": "React Native is a framework for building mobile apps using React."
          }
          // ... more questions
        ]
      },
      "progress": {
        "completed": false,
        "attempts": [
          {
            "attemptNumber": 1,
            "score": 80,
            "completedAt": "2025-11-30T10:00:00Z"
          }
        ],
        "bestScore": 80
      }
    }
  }
}
```

---

**Endpoint 2:** `POST /api/lessons/:lessonId/quiz/submit`

**Request Body:**

```json
{
  "answers": [
    { "questionId": "q1", "selectedOption": "b" },
    { "questionId": "q2", "selectedOption": "a" }
    // ... all answers
  ]
}
```

**Response (Success - 200 OK):**

```json
{
  "success": true,
  "data": {
    "score": 80,
    "totalQuestions": 10,
    "correctAnswers": 8,
    "xpEarned": 40, // 5 XP per correct answer
    "results": [
      {
        "questionId": "q1",
        "correct": true,
        "selectedOption": "b",
        "correctOption": "b",
        "explanation": "..."
      }
      // ... all results
    ]
  }
}
```

---

#### Test Scenarios

**TS1: Take Quiz (All Correct)**

1. Navigate to quiz lesson
2. Answer all 10 questions correctly
3. Click "Finish Quiz"
4. Verify score: 100% (10/10)
5. Verify XP: +50 XP
6. Verify lesson marked complete

**TS2: Take Quiz (Some Incorrect)**

1. Navigate to quiz
2. Answer 8 correctly, 2 incorrectly
3. Finish quiz
4. Verify score: 80%
5. Verify XP: +40 XP (8 \* 5)

**TS3: Retake Quiz**

1. Complete quiz with 60% score
2. Click "Retake Quiz"
3. Complete again with 90% score
4. Verify best score saved: 90%

---

---

### Story 2.2.5: Quiz System - Match Pairs

**Story Points:** 5  
**Priority:** ğŸŸ  High  
**Sprint:** Sprint 5

#### User Story

```
AS A student
I WANT TO match pairs of items (drag & drop or click-based)
SO THAT I can learn relationships between concepts
```

#### Acceptance Criteria

**AC1: Match Pairs Quiz Display**

- GIVEN I am viewing a match pairs quiz
- WHEN the page loads
- THEN I see:
  - Quiz title
  - Instructions: "Match each item on the left with the correct item on the right"
  - Left column: List of terms (e.g., "useState", "useEffect", "useContext")
  - Right column: List of descriptions (shuffled)
  - Matching interface (click or drag & drop)
  - "Submit" button (enabled when all pairs matched)

**AC2: Match Interface (Click-Based)**

- GIVEN I click an item in left column
- WHEN the item is clicked
- THEN:
  - Item highlighted
  - Click an item in right column â†’ creates connection line
  - Line displayed between matched items
  - Can unmatch by clicking matched item again

**AC3: Submit Matches (Correct)**

- GIVEN I have matched all pairs correctly
- WHEN I click "Submit"
- THEN:
  - All lines turn green âœ“
  - Feedback: "Perfect! All matches correct."
  - XP earned (+15 XP for perfect score)
  - Lesson marked complete

**AC4: Submit Matches (Some Incorrect)**

- GIVEN I have some incorrect matches
- WHEN I click "Submit"
- THEN:
  - Correct matches turn green âœ“
  - Incorrect matches turn red âœ—
  - Feedback: "3/5 correct. Try again!"
  - XP earned (3 \* 3 = +9 XP)
  - "Try Again" button

---

#### API Contract

**Endpoint:** `GET /api/lessons/:lessonId` (Match Pairs Quiz)

**Response:**

```json
{
  "lesson": {
    "id": "lesson_222",
    "type": "quiz",
    "content": {
      "quizType": "match_pairs",
      "pairs": [
        {
          "id": "pair1",
          "left": "useState",
          "right": "Manages state in component",
          "leftId": "l1",
          "rightId": "r1"
        },
        {
          "id": "pair2",
          "left": "useEffect",
          "right": "Runs side effects",
          "leftId": "l2",
          "rightId": "r2"
        }
        // ... more pairs
      ]
    }
  }
}
```

---

#### Test Scenarios

**TS1: Match Pairs (All Correct)**

1. Navigate to match pairs quiz
2. Match all pairs correctly
3. Click "Submit"
4. Verify all lines green
5. Verify XP earned
6. Verify lesson complete

---

---

### Story 2.2.6: Quiz System - Fill in Blanks

**Story Points:** 5  
**Priority:** ğŸŸ  High  
**Sprint:** Sprint 5

#### User Story

```
AS A student
I WANT TO fill in missing words in sentences
SO THAT I can practice recall and terminology
```

#### Acceptance Criteria

**AC1: Fill in Blanks Quiz Display**

- GIVEN I am viewing a fill-in-blanks quiz
- WHEN the page loads
- THEN I see:
  - Quiz title
  - Sentences with blank spaces (underscores or input fields)
  - Example: "React Native uses **\_\_\_** to build mobile apps." (answer: "JavaScript")
  - Text input field for each blank
  - "Submit" button

**AC2: Fill Blanks**

- GIVEN I type answers in blank fields
- WHEN all fields are filled
- THEN:
  - "Submit" button enabled

**AC3: Submit Answers (Correct)**

- GIVEN I enter correct answers
- WHEN I click "Submit"
- THEN:
  - Correct answers turn green âœ“
  - XP earned (+5 XP per correct blank)
  - Lesson marked complete

**AC4: Submit Answers (Incorrect)**

- GIVEN I enter some incorrect answers
- WHEN I click "Submit"
- THEN:
  - Correct answers turn green âœ“
  - Incorrect answers turn red âœ—
  - Show correct answer: "Correct answer: JavaScript"
  - Partial XP earned

**AC5: Case Insensitive**

- Answers are case-insensitive
- "javascript" = "JavaScript" = "JAVASCRIPT"
- Trim whitespace

---

#### API Contract

**Response:**

```json
{
  "lesson": {
    "type": "quiz",
    "content": {
      "quizType": "fill_blanks",
      "questions": [
        {
          "id": "q1",
          "text": "React Native uses _____ to build mobile apps.",
          "correctAnswer": "JavaScript",
          "alternateAnswers": ["JS", "javascript"]
        }
      ]
    }
  }
}
```

---

---

### Story 2.2.7: Quiz System - True/False

**Story Points:** 3  
**Priority:** ğŸŸ  High  
**Sprint:** Sprint 5

#### User Story

```
AS A student
I WANT TO answer true/false questions
SO THAT I can quickly test my knowledge
```

#### Acceptance Criteria

**AC1: True/False Quiz Display**

- GIVEN I am viewing a true/false quiz
- WHEN the page loads
- THEN I see:
  - Statement (e.g., "React Native can only build Android apps.")
  - Two buttons: "True" and "False"
  - "Submit" button (after selection)

**AC2: Submit Answer**

- GIVEN I select True or False
- WHEN I click "Submit"
- THEN:
  - If correct â†’ green âœ“, +5 XP
  - If incorrect â†’ red âœ—, show explanation
  - "Next Question" button

---

#### API Contract

**Response:**

```json
{
  "lesson": {
    "type": "quiz",
    "content": {
      "quizType": "true_false",
      "questions": [
        {
          "id": "q1",
          "statement": "React Native can only build Android apps.",
          "correctAnswer": false,
          "explanation": "React Native supports both iOS and Android."
        }
      ]
    }
  }
}
```

---

---

### Story 2.2.8: Quiz System - Sentence Building

**Story Points:** 5  
**Priority:** ğŸŸ  High  
**Sprint:** Sprint 6

#### User Story

```
AS A student
I WANT TO build sentences by arranging words in correct order
SO THAT I can practice syntax and structure
```

#### Acceptance Criteria

**AC1: Sentence Building Quiz Display**

- GIVEN I am viewing a sentence building quiz
- WHEN the page loads
- THEN I see:
  - Instructions: "Arrange the words to form a correct sentence"
  - Scrambled words (buttons/chips)
  - Drop zone (to arrange words)
  - "Submit" button

**AC2: Arrange Words (Drag & Drop or Click)**

- GIVEN I drag/click words
- WHEN I arrange them in order
- THEN:
  - Words appear in drop zone
  - Can reorder by dragging again

**AC3: Submit Sentence (Correct)**

- GIVEN I arrange words correctly
- WHEN I click "Submit"
- THEN:
  - Sentence turns green âœ“
  - XP earned (+10 XP)
  - Explanation shown

**AC4: Submit Sentence (Incorrect)**

- GIVEN incorrect order
- WHEN I click "Submit"
- THEN:
  - Sentence turns red âœ—
  - Show correct order
  - "Try Again" button

---

#### API Contract

**Response:**

```json
{
  "lesson": {
    "type": "quiz",
    "content": {
      "quizType": "sentence_building",
      "questions": [
        {
          "id": "q1",
          "words": ["React", "is", "Native", "a", "framework"],
          "correctOrder": ["React", "Native", "is", "a", "framework"],
          "explanation": "React Native is a framework for building mobile apps."
        }
      ]
    }
  }
}
```

---

---

### Story 2.2.9: Quiz System - Listening (Audio + Questions)

**Story Points:** 5  
**Priority:** ğŸŸ¡ Medium  
**Sprint:** Sprint 6

#### User Story

```
AS A student
I WANT TO listen to audio and answer questions
SO THAT I can practice listening comprehension
```

#### Acceptance Criteria

**AC1: Listening Quiz Display**

- GIVEN I am viewing a listening quiz
- WHEN the page loads
- THEN I see:
  - Audio player (HTML5 audio controls)
  - Instructions: "Listen to the audio and answer the questions"
  - Questions (multiple choice, fill blanks, etc.)
  - "Play Audio" button

**AC2: Play Audio**

- GIVEN I click "Play Audio"
- WHEN the audio plays
- THEN:
  - Audio plays (can pause, replay)
  - Questions remain visible below
  - Can answer while listening or after

**AC3: Submit Answers**

- GIVEN I answer all questions
- WHEN I click "Submit"
- THEN:
  - Answers graded (same as other quiz types)
  - XP earned based on correctness

---

#### API Contract

**Response:**

```json
{
  "lesson": {
    "type": "quiz",
    "content": {
      "quizType": "listening",
      "audioUrl": "https://cdn.babyowl.com/audio/lesson_333.mp3",
      "questions": [
        {
          "id": "q1",
          "text": "What is the speaker's name?",
          "type": "multiple_choice",
          "options": ["John", "Jane", "Sarah", "Mike"],
          "correctAnswer": "John"
        }
      ]
    }
  }
}
```

---

---

### Story 2.2.10: Quiz Grading & Feedback (Auto-Grade, Show Results)

**Story Points:** 5  
**Priority:** ğŸŸ  High  
**Sprint:** Sprint 6

#### User Story

```
AS A student
I WANT TO see my quiz results immediately after submission
SO THAT I know what I got right/wrong and can learn from mistakes
```

#### Acceptance Criteria

**AC1: Immediate Feedback**

- All quiz types auto-graded (no instructor grading needed)
- Results shown immediately after submission

**AC2: Results Summary Page**

- GIVEN I complete a quiz
- WHEN results load
- THEN I see:
  - Overall score (e.g., "80% - 8/10 correct")
  - XP earned (e.g., "+40 XP")
  - Breakdown by question:
    - Question text
    - Your answer
    - Correct answer
    - Explanation
    - âœ“ or âœ— indicator
  - "Retake Quiz" button
  - "Continue to Next Lesson" button

**AC3: Passing/Failing Threshold**

- Pass threshold: 70%
- If <70%:
  - Show message: "You need 70% to pass. Try again!"
  - Lesson NOT marked complete
  - Can retake unlimited times
- If â‰¥70%:
  - Show message: "Great job! You passed!"
  - Lesson marked complete
  - XP awarded

**AC4: Best Score Saved**

- If student retakes quiz:
  - All attempts recorded
  - Best score displayed (not most recent)
  - Example: Attempt 1: 60%, Attempt 2: 90% â†’ show 90%

---

#### Test Scenarios

**TS1: Quiz Results (Pass)**

1. Complete quiz with 90% score
2. Verify results page shows:
   - "90% - 9/10 correct"
   - "+45 XP"
   - Breakdown of all questions
3. Verify lesson marked complete

**TS2: Quiz Results (Fail)**

1. Complete quiz with 50% score
2. Verify message: "You need 70% to pass"
3. Verify lesson NOT complete
4. Click "Retake Quiz"
5. Complete with 80%
6. Verify lesson now complete

---

---

### Story 2.2.11: Coding Exercise - Challenge Mode (with Test Cases)

**Story Points:** 13  
**Priority:** ğŸŸ  High  
**Sprint:** Sprint 6-7

#### User Story

```
AS A student
I WANT TO write Python code and have it automatically tested against test cases
SO THAT I can practice programming with immediate feedback
```

#### Acceptance Criteria

**AC1: Coding Challenge Exercise Display**

- GIVEN I am viewing a coding challenge exercise
- WHEN the page loads
- THEN I see:
  - Exercise title (e.g., "Calculate Rectangle Area")
  - Instructions panel (HTML/markdown, collapsible)
  - Code editor (Monaco Editor or CodeMirror):
    - Syntax highlighting for Python
    - Line numbers
    - Auto-indentation
    - Starter code pre-filled
  - "Run Code" button (execute without submitting)
  - "Submit" button (run test cases)
  - Output console (below editor):
    - Show print statements
    - Show errors (syntax, runtime)
  - Test results panel:
    - List of test cases (visible and hidden)
    - Pass/fail status for each
    - Points earned

**AC2: Code Execution (Run)**

- GIVEN I write Python code
- WHEN I click "Run Code"
- THEN:
  - Code executed in browser (Pyodide - WebAssembly Python)
  - Output displayed in console panel
  - Syntax errors shown with line numbers
  - Runtime errors shown with traceback
  - Execution timeout: 30 seconds max
  - No test cases run (just executes code)

**AC3: Submit Code (Run Test Cases)**

- GIVEN I click "Submit"
- WHEN the code is submitted
- THEN:
  - All test cases executed against my code
  - For each visible test case:
    - Show input
    - Show expected output
    - Show actual output
    - âœ… Pass or âŒ Fail indicator
  - For hidden test cases:
    - Show only pass/fail (not input/output)
    - Badge: "Hidden Test 1: âœ…" or "Hidden Test 1: âŒ"
  - Score calculated: (passed tests / total tests) Ã— max points
  - If all tests pass:
    - "All tests passed!" message
    - XP earned (based on points)
    - Exercise marked complete
  - If some fail:
    - "X/Y tests passed" message
    - Can retry unlimited times
    - Best score saved

**AC4: Test Case Structure**

- Each test case has:
  - Name (e.g., "Test 1: Basic case")
  - Input (function arguments or stdin)
  - Expected output (return value or stdout)
  - Points (e.g., 10 points)
  - Hidden flag (true/false)

**AC5: Code Editor Features**

- Syntax highlighting (Python)
- Auto-complete (basic Python keywords)
- Error highlighting (red underline)
- Copy/paste support
- Undo/redo support
- Font size adjustment
- Dark/light theme option

**AC6: Memory & Time Limits**

- Execution timeout: 30 seconds per test case
- Memory limit: 50MB
- Infinite loop detection (timeout + warning)

**AC7: Hints System (Optional)**

- If hints provided:
  - "Hint" button (collapsible)
  - Multiple hints available (progressively revealed)
  - No penalty for using hints

---

#### Edge Cases

**E1: Syntax Error**

- If code has syntax error:
  - Show error message with line number
  - Highlight line in editor
  - "Syntax error on line 5: unexpected indent"

**E2: Runtime Error**

- If code throws exception:
  - Show error type and message
  - Show traceback (simplified)
  - "NameError: name 'x' is not defined"

**E3: Infinite Loop**

- If code runs >30 seconds:
  - Kill execution
  - Show warning: "Execution timed out. Your code may have an infinite loop."

**E4: No Code Submitted**

- If student clicks Submit with empty code:
  - Show error: "Please write some code before submitting"

**E5: Partial Correctness**

- If 3/5 test cases pass:
  - Show 60% score
  - Allow retry
  - Best score saved

**E6: Large Output**

- If output >10KB:
  - Truncate with message: "Output truncated (too long)"

---

#### API Contract

**Endpoint 1:** `GET /api/exercises/:exerciseId` (Coding Challenge)

**Response:**

```json
{
  "success": true,
  "data": {
    "exercise": {
      "id": "exercise_coding_001",
      "title": "Calculate Rectangle Area",
      "type": "coding",
      "content": {
        "mode": "challenge",
        "language": "python",
        "instructions": "<h2>Calculate Rectangle Area</h2><p>Write a function <code>calculate_area(width, height)</code> that returns the area of a rectangle.</p><h3>Example:</h3><pre>calculate_area(5, 3) â†’ 15</pre>",
        "starterCode": "def calculate_area(width, height):\n    # Write your code here\n    pass",
        "testCases": [
          {
            "id": "tc1",
            "name": "Test 1: Basic case",
            "input": "calculate_area(5, 3)",
            "expectedOutput": "15",
            "isHidden": false,
            "points": 10
          },
          {
            "id": "tc2",
            "name": "Test 2: Zero width",
            "input": "calculate_area(0, 10)",
            "expectedOutput": "0",
            "isHidden": false,
            "points": 10
          },
          {
            "id": "tc3",
            "name": "Hidden Test 1",
            "input": "calculate_area(100, 200)",
            "expectedOutput": "20000",
            "isHidden": true,
            "points": 10
          }
        ],
        "hints": [
          "Remember: Area = width Ã— height",
          "Make sure to return the result, not print it"
        ],
        "solutionCode": "def calculate_area(width, height):\n    return width * height",
        "timeLimit": 30,
        "maxPoints": 30
      },
      "progress": {
        "completed": false,
        "bestScore": 20,
        "attempts": 2
      }
    }
  }
}
```

---

**Endpoint 2:** `POST /api/exercises/:exerciseId/coding/run` (Run without tests)

**Request Body:**

```json
{
  "code": "def calculate_area(width, height):\n    return width * height\n\nprint(calculate_area(5, 3))"
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "output": "15\n",
    "error": null,
    "executionTime": 120
  }
}
```

---

**Endpoint 3:** `POST /api/exercises/:exerciseId/coding/submit` (Run with test cases)

**Request Body:**

```json
{
  "code": "def calculate_area(width, height):\n    return width * height"
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "score": 30,
    "maxScore": 30,
    "testResults": [
      {
        "id": "tc1",
        "name": "Test 1: Basic case",
        "passed": true,
        "input": "calculate_area(5, 3)",
        "expectedOutput": "15",
        "actualOutput": "15",
        "isHidden": false,
        "points": 10
      },
      {
        "id": "tc2",
        "name": "Test 2: Zero width",
        "passed": true,
        "input": "calculate_area(0, 10)",
        "expectedOutput": "0",
        "actualOutput": "0",
        "isHidden": false,
        "points": 10
      },
      {
        "id": "tc3",
        "name": "Hidden Test 1",
        "passed": true,
        "isHidden": true,
        "points": 10
      }
    ],
    "allPassed": true,
    "xpEarned": 30,
    "exerciseCompleted": true
  }
}
```

---

#### Dependencies

- Pyodide (WebAssembly Python runtime)
- Monaco Editor or CodeMirror (code editor)
- Module 7 (Progress tracking)
- Module 8 (XP system)

---

#### Test Scenarios

**TS1: Complete Coding Challenge (All Pass)**

1. Navigate to coding challenge exercise
2. Read instructions
3. Write correct solution in editor
4. Click "Run Code" â†’ verify output shows correctly
5. Click "Submit"
6. Verify all test cases pass (visible + hidden)
7. Verify score: 30/30
8. Verify XP earned
9. Verify exercise marked complete

**TS2: Partial Correctness**

1. Write partially correct code
2. Submit
3. Verify 2/3 test cases pass
4. Verify score: 20/30
5. Fix code, resubmit
6. Verify 3/3 pass, score: 30/30

**TS3: Syntax Error Handling**

1. Write code with syntax error
2. Click "Run Code"
3. Verify error shown with line number
4. Fix error, run again â†’ success

**TS4: Timeout Handling**

1. Write infinite loop: `while True: pass`
2. Click "Run Code"
3. Wait 30 seconds
4. Verify timeout error shown

---

#### UI/UX Notes

**Coding Challenge Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back to Lesson           Exercise 2 of 5           [Hints â–¾] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“ Instructions                                    [Collapse â–¾]â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Calculate Rectangle Area                                  â”‚ â”‚
â”‚  â”‚ Write a function calculate_area(width, height)...         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’» Code Editor                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1â”‚ def calculate_area(width, height):                    â”‚ â”‚
â”‚  â”‚  2â”‚     # Write your code here                            â”‚ â”‚
â”‚  â”‚  3â”‚     pass                                              â”‚ â”‚
â”‚  â”‚  4â”‚                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  [ â–¶ï¸ Run Code ]    [ âœ… Submit ]                               â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“º Output                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ > 15                                                      â”‚ â”‚
â”‚  â”‚ > Program finished successfully                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š Test Results                               Score: 20/30 pts â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ… Test 1: Basic case (10 pts)                            â”‚ â”‚
â”‚  â”‚    Input: calculate_area(5, 3)                            â”‚ â”‚
â”‚  â”‚    Expected: 15  |  Actual: 15                            â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚ âœ… Test 2: Zero width (10 pts)                            â”‚ â”‚
â”‚  â”‚    Input: calculate_area(0, 10)                           â”‚ â”‚
â”‚  â”‚    Expected: 0  |  Actual: 0                              â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚ ğŸ”’ Hidden Test 1 (10 pts)                       âŒ Failed  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  [ â† Previous ]                              [ Next Exercise â†’ ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Colors:**

- Pass indicator: `ALERT_SUCCESS_100` (green)
- Fail indicator: `ALERT_ERROR_100` (red)
- Editor background: `GREYSCALE_900` (dark theme) or `GREYSCALE_0` (light theme)
- Syntax highlighting: Standard Python colors

---

---

### Story 2.2.12: Coding Exercise - Playground Mode (Interactive Python)

**Story Points:** 10  
**Priority:** ğŸŸ  High  
**Sprint:** Sprint 7

#### User Story

```
AS A student
I WANT TO write and run Python code interactively without test cases
SO THAT I can experiment, build projects, and see visual outputs (turtle graphics, charts, etc.)
```

#### Acceptance Criteria

**AC1: Coding Playground Exercise Display**

- GIVEN I am viewing a coding playground exercise
- WHEN the page loads
- THEN I see:
  - Exercise title (e.g., "Draw a Square with Turtle")
  - Instructions panel (HTML/markdown)
  - Code editor (Monaco Editor or CodeMirror):
    - Starter code pre-filled
    - Full Python syntax support
  - "Run Code" button
  - "Reset Code" button (restore starter code)
  - "Mark as Complete" button
  - Output area (split into two):
    - Console output (text)
    - Visual canvas (for turtle, matplotlib, etc.)
  - Package indicator (show pre-loaded packages)

**AC2: Console Output Mode**

- GIVEN code produces text output (print statements)
- WHEN I click "Run Code"
- THEN:
  - Text output displayed in console panel
  - Support ANSI colors (basic)
  - Clear console on each run

**AC3: Visual Output Mode (Turtle, Matplotlib, etc.)**

- GIVEN code uses visual libraries (turtle, matplotlib)
- WHEN I click "Run Code"
- THEN:
  - Visual output rendered in canvas panel
  - Support for:
    - **Turtle graphics**: Drawing shapes, patterns
    - **Matplotlib**: Charts, plots, graphs
    - **PIL/Pillow**: Image manipulation (display result)
  - Canvas resizable
  - "Clear Canvas" button

**AC4: Pre-loaded Packages**

- GIVEN exercise requires specific packages
- WHEN exercise loads
- THEN:
  - Required packages pre-loaded (e.g., turtle, matplotlib, numpy)
  - Package list shown: "ğŸ“¦ Packages: turtle, math"
  - No need for `import micropip` (handled automatically)

**AC5: Completion Criteria (No Test Cases)**

- Since no test cases, completion based on:
  - Student clicks "Mark as Complete" after running code at least once
  - OR instructor defines minimum run count (e.g., run 3x = complete)
- XP earned upon completion (+15 XP)

**AC6: Reset Code**

- GIVEN I click "Reset Code"
- WHEN confirmed
- THEN:
  - Editor content restored to original starter code
  - Output/canvas cleared
  - Progress NOT affected (can still mark complete)

**AC7: Auto-detect Output Type**

- System automatically detects output type:
  - If only `print()` â†’ show console only
  - If `turtle` or `matplotlib` â†’ show canvas + console
  - If both â†’ show split view

---

#### Edge Cases

**E1: No Output**

- If code produces no output:
  - Show message: "Program finished. No output."
  - Still allow marking complete

**E2: Turtle Animation Speed**

- If turtle animation too slow:
  - Show speed controls (instant, fast, slow)
  - Default: fast (not instant, so student sees animation)

**E3: Large Chart/Image**

- If matplotlib output too large:
  - Scale to fit canvas
  - Allow zoom/pan

**E4: Package Not Available**

- If code tries to import unavailable package:
  - Show error: "Package 'xyz' not available. Available packages: turtle, matplotlib, numpy..."

**E5: Multiple Runs**

- Canvas clears on each run (no accumulation)
- Console clears on each run

---

#### API Contract

**Endpoint:** `GET /api/exercises/:exerciseId` (Coding Playground)

**Response:**

```json
{
  "success": true,
  "data": {
    "exercise": {
      "id": "exercise_playground_001",
      "title": "Draw a Square with Turtle",
      "type": "coding",
      "content": {
        "mode": "playground",
        "language": "python",
        "outputType": "visual",
        "instructions": "<h2>Draw a Square</h2><p>Use Python's turtle module to draw a square with 100-pixel sides.</p><h3>Hints:</h3><ul><li>Use <code>t.forward(100)</code> to move forward</li><li>Use <code>t.right(90)</code> to turn right</li></ul>",
        "starterCode": "import turtle\n\nt = turtle.Turtle()\n\n# Draw a square here\nfor i in range(4):\n    t.forward(100)\n    t.right(90)\n\nturtle.done()",
        "requiredPackages": ["turtle"],
        "completionCriteria": "run_once",
        "hints": [
          "A square has 4 equal sides",
          "You need to turn 90 degrees at each corner"
        ]
      },
      "progress": {
        "completed": false,
        "runCount": 0
      }
    }
  }
}
```

---

**Endpoint:** `POST /api/exercises/:exerciseId/coding/run` (Same as Challenge)

**Response (with visual output):**

```json
{
  "success": true,
  "data": {
    "output": "",
    "visualOutput": {
      "type": "turtle",
      "commands": [
        { "action": "forward", "value": 100 },
        { "action": "right", "value": 90 }
      ]
    },
    "error": null,
    "executionTime": 250
  }
}
```

---

**Endpoint:** `POST /api/exercises/:exerciseId/complete` (Mark playground complete)

**Request Body:**

```json
{
  "completed": true
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "exercise": {
      "id": "exercise_playground_001",
      "completed": true,
      "completedAt": "2025-12-01T14:30:00Z"
    },
    "xpEarned": 15
  }
}
```

---

#### Supported Packages (Pyodide)

| Category          | Packages                           |
| ----------------- | ---------------------------------- |
| **Graphics**      | turtle (custom canvas), matplotlib |
| **Data**          | numpy, pandas (basic)              |
| **Math**          | math, random, statistics           |
| **Text**          | re, string, json                   |
| **Date/Time**     | datetime, time                     |
| **Image**         | Pillow (PIL)                       |
| **Visualization** | matplotlib, seaborn (limited)      |

---

#### Test Scenarios

**TS1: Turtle Graphics**

1. Navigate to turtle playground exercise
2. Write code to draw a square
3. Click "Run Code"
4. Verify square appears in canvas
5. Click "Mark as Complete"
6. Verify XP earned (+15)
7. Verify exercise marked complete

**TS2: Matplotlib Chart**

1. Navigate to matplotlib playground
2. Write code to create bar chart
3. Click "Run Code"
4. Verify chart renders in canvas
5. Mark complete

**TS3: Console Only (Calculator)**

1. Navigate to calculator playground
2. Write simple calculator code
3. Click "Run Code"
4. Verify output in console
5. Mark complete

**TS4: Reset Code**

1. Modify starter code
2. Click "Reset Code"
3. Confirm reset
4. Verify code restored to original
5. Verify canvas cleared

---

#### UI/UX Notes

**Coding Playground Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back to Lesson           Exercise 3 of 5                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“ Draw a Square with Turtle                                   â”‚
â”‚  Use Python's turtle module to draw a square with 100px sides.  â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’» Code Editor                 â”‚  ğŸ¨ Output                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  1â”‚ import turtle           â”‚â”‚  â”‚                           â”‚â”‚
â”‚  â”‚  2â”‚                         â”‚â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚â”‚
â”‚  â”‚  3â”‚ t = turtle.Turtle()     â”‚â”‚  â”‚      â”‚            â”‚       â”‚â”‚
â”‚  â”‚  4â”‚                         â”‚â”‚  â”‚      â”‚            â”‚       â”‚â”‚
â”‚  â”‚  5â”‚ for i in range(4):      â”‚â”‚  â”‚      â”‚            â”‚       â”‚â”‚
â”‚  â”‚  6â”‚     t.forward(100)      â”‚â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚â”‚
â”‚  â”‚  7â”‚     t.right(90)         â”‚â”‚  â”‚                           â”‚â”‚
â”‚  â”‚  8â”‚                         â”‚â”‚  â”‚        ğŸ¢ Turtle           â”‚â”‚
â”‚  â”‚  9â”‚ turtle.done()           â”‚â”‚  â”‚                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                 â”‚                               â”‚
â”‚                                 â”‚  ğŸ“º Console                   â”‚
â”‚                                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                 â”‚  â”‚ > Program finished        â”‚â”‚
â”‚                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“¦ Packages: turtle, math                                      â”‚
â”‚                                                                 â”‚
â”‚  [ â–¶ï¸ Run Code ]  [ ğŸ”„ Reset ]  [ âœ… Mark as Complete ]         â”‚
â”‚                                                                 â”‚
â”‚  [ â† Previous ]                              [ Next Exercise â†’ ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Colors:**

- Canvas background: `GREYSCALE_0` (light)
- Canvas border: `GREYSCALE_200`
- Run button: `PRIMARY_200` (purple)
- Mark complete button: `ALERT_SUCCESS_100` (green)

---

---

## ğŸ“Š Module Summary

### Total Story Points: 75

| Story  | Title                                   | Points |
| ------ | --------------------------------------- | ------ |
| 2.2.1  | Video Lessons (YouTube Embed, Progress) | 8      |
| 2.2.2  | Reading Materials (Rich Text)           | 5      |
| 2.2.3  | File Downloads                          | 3      |
| 2.2.4  | Quiz - Multiple Choice                  | 8      |
| 2.2.5  | Quiz - Match Pairs                      | 5      |
| 2.2.6  | Quiz - Fill in Blanks                   | 5      |
| 2.2.7  | Quiz - True/False                       | 3      |
| 2.2.8  | Quiz - Sentence Building                | 5      |
| 2.2.9  | Quiz - Listening                        | 5      |
| 2.2.10 | Quiz Grading & Feedback                 | 5      |
| 2.2.11 | Coding Exercise - Challenge Mode        | 13     |
| 2.2.12 | Coding Exercise - Playground Mode       | 10     |

---

## âœ… Module Completion Checklist

Module is complete when:

- [ ] All 12 user stories implemented
- [ ] Video lessons working (YouTube embed, progress tracking)
- [ ] Reading materials displaying correctly (rich text, images)
- [ ] File downloads functional
- [ ] All 6 quiz types implemented and tested:
  - [ ] Multiple Choice
  - [ ] Match Pairs
  - [ ] Fill in Blanks
  - [ ] True/False
  - [ ] Sentence Building
  - [ ] Listening
- [ ] Quiz auto-grading working
- [ ] Coding exercises implemented:
  - [ ] Challenge Mode (with test cases, auto-grading)
  - [ ] Playground Mode (turtle, matplotlib, console)
  - [ ] Pyodide (WebAssembly Python) integrated
  - [ ] Code editor (Monaco/CodeMirror) integrated
  - [ ] Syntax highlighting working
  - [ ] Error handling (syntax, runtime, timeout)
- [ ] XP system integrated (earn XP for completion)
- [ ] Progress tracking working (resume from last position)
- [ ] Unit tests (>80% coverage)
- [ ] Integration tests (end-to-end quiz flow, coding exercises)
- [ ] Mobile responsive (all content types)
- [ ] Accessibility tested (WCAG AA)
- [ ] Documentation complete

---

**End of Module 4: Content Delivery**

_Next Module: [Module 5: Assignment System â†’](../module-05-assignment-system/2.3-assignment-system.md)_
